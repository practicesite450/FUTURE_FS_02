<div class="bg-white rounded-2xl shadow-md hover:shadow-xl transition-all duration-300 overflow-hidden group">
    <img src="{{ product.image.url }}" alt="{{ product.name }}" 
         class="w-full h-52 object-cover group-hover:scale-105 transition-transform duration-300">

    <div class="p-4">
        <h3 class="text-lg font-semibold text-gray-800">{{ product.name }}</h3>
        <p class="text-sm text-green-600 product-category">{{ product.category }}</p>

        <div class="flex items-center mt-2 text-yellow-500">
            <span class="text-sm font-medium">{{ product.rating|default:"4.5" }}</span>
            <span class="text-gray-400 text-sm ml-1">({{ product.reviews|default:"120" }})</span>
        </div>

        <p class="text-gray-500 text-sm mt-2 line-clamp-2">{{ product.description|truncatewords:12 }}</p>

        <div class="mt-4 flex items-center justify-between">
            <span class="text-lg font-semibold text-green-700">${{ product.price }}</span>

            <!-- AJAX Button -->
            <form class="add-to-cart-form" data-product-id="{{ product.id }}" method="post">
    {% csrf_token %}
    <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
        Add to Cart
    </button>
</form>

        </div>
    </div>
</div>

<script>
document.querySelectorAll('.add-to-cart-btn').forEach(button => {
    button.addEventListener('click', function() {
        const productId = this.dataset.id;
        fetch(`/orders/add-to-cart/${productId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',  // CSRF token
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                // Update cart count in header
                const cartCount = document.getElementById('cart-count');
                if(cartCount) cartCount.textContent = data.cartItemCount;
            }
        });
    });
});
</script>
